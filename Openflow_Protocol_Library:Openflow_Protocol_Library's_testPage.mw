= 4.   Threads =

Library uses Netty’s threads provided by
EventLoop for processing received messages. One thread per channel. Threads are
used even for further processing until they are released. The sooner the input
/ output thread is released, the sooner the library starts to process new
message.


  
= 8.   Message specifications =
  
== 8.1   OF 1.0 and OF 1.3 message differencesfsdfgf ==
 
There
are differences between OF 1.0 and OF 1.3 messages (for example the ofp_match
structure is completely different). These differences are handled by using
additional fields in generated DTOs.

 
For
example:

 
Packet-in
message in OF 1.0 (see structure below) would have in_port field set and
table_id, cookie, match fields empty (null). The packet-in message in OF 1.3
would be the opposite.

  
[[Image:image016.png]]

 
Packet-in
message in OF 1.0

  
[[Image:image017.png]]

 
Packet-in
message in OF 1.3

  
== 8.2   OF 1.0 Vendor and Stats messages DTOs ==
 
Vendor messages are represented as
ExperimenterMessage/ExperimenterInput objects (as the messages were renamed in
the OF 1.3 version). Similarly Stats messages use
MultipartReplyMessage/MultipartRequestInput objects.

 
== 8.3   Using supertypes (higher types) ==
 
Values
used for communication with switch are represented as unsigned values. Java
uses signed values - which can store only a half of unsigned (positive) values.
To ensure that correct values are (de)serialized, the values are set into
supertypes (higher types). For example uint32 is represented as Long, uint16 as
Integer and so on.

  
== 8.4   Signed int to unsigned long conversion and vice versa ==
 
There
are cases when we need to convert signed integer into unsigned long. For
example the ofp_port_no (special port values in OF 1.3). Yang generates enums
with .getIntValue() method. Special values (like 0xffffffff) would be
represented as negative integers. For this purpose it is needed to use
BinContent class. It is located in openflow-protocol-api project, under
src/main/java/*.util package. This class does the translation into unsigned
value. BinContent also provides method for the opposite case.

  
== 8.5   Augmentation tables ==
 
Tables below show which augmentations are
used for match, instruction, action, table features and queue properties.

  
<div  align="center">                                                                                                                                                                      
{| border="1"
|-
| 
'''Match
field'''

 
| 
'''Augmentation'''

 
|-
| 
In_Port

 
| 
PortNumberMatchEntry

 
|-
| 
In_Phy_Port

 
| 
PortNumberMatchEntry

 
|-
| 
Metadata

 
| 
MetadataMatchEntry,
MaskMatchEntry

 
|-
| 
Eth_Dst

 
| 
MacAddressMatchEntry,
MaskMatchEntry

 
|-
| 
Eth_Src

 
| 
MacAddressMatchEntry,
MaskMatchEntry

 
|-
| 
Eth_Type

 
| 
EthTypeMatchEntry

 
|-
| 
Vlan_Vid

 
| 
VlanVidMatchEntry,
MaskMatchEntry

 
|-
| 
Vlan_Pcp

 
| 
VlanPcpMatchEntry

 
|-
| 
Ip_Dscp

 
| 
DscpMatchEntry

 
|-
| 
Ip_Ecn

 
| 
EcnMatchEntry

 
|-
| 
Ip_Proto

 
| 
PortNumberMatchEntry

 
|-
| 
Ipv4_Src

 
| 
Ipv4AddressMatchEntry,
MaskMatchEntry

 
|-
| 
Ipv4_Dst

 
| 
Ipv4AddressMatchEntry,
MaskMatchEntry

 
|-
| 
Tcp_Src

 
| 
PortMatchEntry

 
|-
| 
Tcp_Dst

 
| 
PortMatchEntry

 
|-
| 
Udp_Src

 
| 
PortMatchEntry

 
|-
| 
Udp_Dst

 
| 
PortMatchEntry

 
|-
| 
Sctp_Src

 
| 
PortMatchEntry

 
|-
| 
Sctp_Dst

 
| 
PortMatchEntry

 
|-
| 
Icmpv4_Type

 
| 
Icmpv4TypeMatchEntry

 
|-
| 
Icmpv4_Code

 
| 
Icmpv4CodeMatchEntry

 
|-
| 
Arp_Op

 
| 
OpCodeMatchEntry

 
|-
| 
Arp_Spa

 
| 
Ipv4AddressMatchEntry,
MaskMatchEntry

 
|-
| 
Arp_Tpa

 
| 
Ipv4AddressMatchEntry,
MaskMatchEntry

 
|-
| 
Arp_Sha

 
| 
MacAddressMatchEntry,
MaskMatchEntry

 
|-
| 
Arp_Tha

 
| 
MacAddressMatchEntry,
MaskMatchEntry

 
|-
| 
Ipv6_Src

 
| 
Ipv6AddressMatchEntry,
MaskMatchEntry

 
|-
| 
Ipv6_Dst

 
| 
Ipv6AddressMatchEntry,
MaskMatchEntry

 
|-
| 
Ipv6_Flabel

 
| 
Ipv6FlabelMatchEntry,
MaskMatchEntry

 
|-
| 
Icmpv6_Type

 
| 
Icmpv6TypeMatchEntry

 
|-
| 
Icmpv6_Code

 
| 
Icmpv6CodeMatchEntry

 
|-
| 
Ipv6_Nd_Target

 
| 
Ipv6AddressMatchEntry

 
|-
| 
Ipv6_Nd_Sll

 
| 
MacAddressMatchEntry

 
|-
| 
Ipv6_Nd_Tll

 
| 
MacAddressMatchEntry

 
|-
| 
Mpls_Label

 
| 
MplsLabelMatchEntry

 
|-
| 
Mpls_Tc

 
| 
TcMatchEntry

 
|-
| 
Mpls_Bos

 
| 
BosMatchEntry

 
|-
| 
Pbb_Isid

 
| 
IsidMatchEntry,
MaskMatchEntry

 
|-
| 
Tunnel_Id

 
| 
MetadataMatchEntry,
MaskMatchEntry

 
|-
| 
Ipv6_Exthdr

 
| 
PseudoFieldMatchEntry,
MaskMatchEntry

 
|} 
</div> 
MatchEntries
(oxm_fields) augmentations table (OF 1.3)

 
*MaskMatchEntry
is present only if the mask is provided and hasMask flag is true

  
<div  align="center">                              
{| border="1"
|-
| 
'''Instruction
type'''

 
| 
'''Augmentation'''

 
|-
| 
Goto_Table

 
| 
TableIdInstruction

 
|-
| 
Write_Metadata

 
| 
MetadataInstruction

 
|-
| 
Write_Actions

 
| 
ActionsInstruction

 
|-
| 
Apply_Actions

 
| 
ActionsInstruction

 
|-
| 
Clear_Actions

 
| 
ActionsInstruction

 
|-
| 
Meter

 
| 
MeterIdInstruction

 
|} 
</div> 
Instructions
augmentations table (OF 1.3)

  
<div  align="center">                                                      
{| border="1"
|-
| 
'''Action
type'''

 
| 
'''Augmentation'''

 
|-
| 
Output

 
| 
PortAction,
MaxLengthAction

 
|-
| 
Set_Vlan_Vid

 
| 
VlanVidAction

 
|-
| 
Set_Vlan_Pcp

 
| 
VlanPcpAction

 
|-
| 
Strip_Vlan

 
| 
-

 
|-
| 
Set_Dl_Src

 
| 
DlAddressAction

 
|-
| 
Set_Dl_Dst

 
| 
DlAddressAction

 
|-
| 
Set_Nw_Src

 
| 
IpAddressAction

 
|-
| 
Set_Nw_Dst

 
| 
IpAddressAction

 
|-
| 
Set_Nw_Tos

 
| 
NwTosAction

 
|-
| 
Set_Tp_Src

 
| 
PortAction

 
|-
| 
Set_Tp_Dst

 
| 
PortAction

 
|-
| 
Enqueue

 
| 
PortAction,
QueueIdAction

 
|} 
</div> 
Actions
augmentations table (OF 1.0)

    
<div  align="center">                                                                      
{| border="1"
|-
| 
'''Action
type'''

 
| 
'''Augmentation'''

 
|-
| 
Output

 
| 
PortAction,
MaxLengthAction

 
|-
| 
Copy_Ttl_Out

 
| 
-

 
|-
| 
Copy_Ttl_In

 
| 
-

 
|-
| 
Set_Mpls_Ttl

 
| 
MplsTtlAction

 
|-
| 
Dec_Mpls_Ttl

 
| 
-

 
|-
| 
Push_Vlan

 
| 
EthertypeAction

 
|-
| 
Pop_Vlan

 
| 
-

 
|-
| 
Push_Mpls

 
| 
EthertypeAction

 
|-
| 
Pop_Mpls

 
| 
EthertypeAction

 
|-
| 
Set_Queue

 
| 
QueueIdAction

 
|-
| 
Group

 
| 
GroupIdAction

 
|-
| 
Set_Nw_Ttl

 
| 
NwTtlAction

 
|-
| 
Dec_Nw_Ttl

 
| 
-

 
|-
| 
Set_Field

 
| 
OxmFieldsAction

 
|-
| 
Push_Pbb

 
| 
EthertypeAction

 
|-
| 
Pop_Pbb

 
| 
-

 
|} 
</div> 
Actions
augmentations table (OF 1.3)

  
<div  align="center">                                                              
{| border="1"
|-
| 
'''TableFeatureProperty
type'''

 
| 
'''Augmentation'''

 
|-
| 
Instructions

 
| 
InstructionRelatedTableFeatureProperty

 
|-
| 
Instructions_Miss

 
| 
InstructionRelatedTableFeatureProperty

 
|-
| 
Next_Tables

 
| 
NextTableRelatedTableFeatureProperty

 
|-
| 
Next_Tables_Miss

 
| 
NextTableRelatedTableFeatureProperty

 
|-
| 
Write_Actions

 
| 
ActionRelatedTableFeatureProperty

 
|-
| 
Write_Actions_Miss

 
| 
ActionRelatedTableFeatureProperty

 
|-
| 
Apply_Actions

 
| 
ActionRelatedTableFeatureProperty

 
|-
| 
Apply_Actions_Miss

 
| 
ActionRelatedTableFeatureProperty

 
|-
| 
Match

 
| 
OxmRelatedTableFeatureProperty

 
|-
| 
Wildcards

 
| 
OxmRelatedTableFeatureProperty

 
|-
| 
Write_Setfield

 
| 
OxmRelatedTableFeatureProperty

 
|-
| 
Write_Setfield_Miss

 
| 
OxmRelatedTableFeatureProperty

 
|-
| 
Apply_Setfield

 
| 
OxmRelatedTableFeatureProperty

 
|-
| 
Apply_Setfield_Miss

 
| 
OxmRelatedTableFeatureProperty

 
|} 
</div> 
TableFeatureProperties
augmentation table (OF 1.3)

  
<div  align="center">              
{| border="1"
|-
| 
'''QueueProperty
type'''

 
| 
'''Augmentation'''

 
|-
| 
Min_Rate

 
| 
RateQueueProperty

 
|-
| 
Max_Rate

 
| 
RateQueueProperty

 
|} 
</div> 
QueueProperties
augmentation table (OF 1.3)

  
== 8.6   Table-miss flow entry ==
 
To
set up a table-miss flow entry in switch table it is needed to create FlowMod
message with desired flow properties and an empty match. Match is considered
empty when it has only type specified (no oxm_fields are present).

    
= 9.   Glossary =
  
DTO – Data Transfer Object

 
XID – transaction ID in OpenFlow message
(header)

 
ResponseCache – expiring cache for future rpc
responses. Default rpc response expiration time is set to one minute. Entry
that has been in cache longer than one minute will be automatically removed.
Cache uses removal listener, which checks the reason of removal. If the reason
was expiration time, entry is cancelled.

 
RpcResponseKey – this class is used as a key
in responseCache. It contains XID and received DTO’s class fields, which are
used for lookup in responseCache.

   
= 10.                 Useful links =
  
https://wiki.opendaylight.org/view/Openflow_Protocol_Library:Main

 
</div>
