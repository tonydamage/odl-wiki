
= VTN Manager Implementation =

VTN Manager will be implemented in Java, and consists of OSGi bundles in an OpenDaylight Controller.
It provides virtual network functions for VTN Coordinator via REST API.

VTN Manager is developed from scratch to take advantage of functions of the OpenDaylight controller.

[[File:vtn_manager_and_relevant_bundles.png|550px]]

== Development milestone ==

Initial submittal for the following features is slated at Milestone 2.

* VTN multi-tenancy
* vBridge function

With the above features, OpenDaylight Controller can have the capability to create virtual L2 network, and set up flow entries to OpenFlow switches based on OpenFlow 1.0.


=== REST API to be provided ===

* VTN GET/POST/DELETE
* vBridge GET/POST/DELETE
* Interface GET/POST/DELETE
* Port map GET/POST/DELETE
* Vlan map GET/POST/DELETE


=== VTN Manager for VTN multi-tenancy ===
We planed to create a container for each VTN.
However, it seems that current containermanager in OpenDaylight Controller does not implement container creation function, except default container.
Therefore, we are planning to create all VTNs and its vNodes in default container at Milestone 2.
After the implementation plan of containermanager become clear, we will revisit this design.


=== VTN Manager for vBridge ===
To enable virtual L2 network, VTN Manger has the following functions.

* Create MAC address tables per vBridge
* Receive Packet-In events, send Packet-Out, and set up flow entries to switches based on the destination MAC address
* Drop packets from a port not VTN provisioned


=== Relevant OSGi bundles ===
VTN Manager uses services provided by the following OSGi bundles in OpenDaylight Controller.

* OSGi bundles to be used as is:
** Forwarding Rule Manager
** Routing
** Container
** HostTracker


* OSGi bundles to be enhanced:
** ArpHandler
*** add a service to disable ArpHandler

VTN Manager have to broadcast ARP Request packets only within a configured vBridge.
However, ArpHandler handles ARP packets depending on subnet infromation registered on ISwitchManager, not on configuration of vBridges.
Moreover, after ArpHandler handles ARP packets, ARP events are not propagated to other bundles, so VTN Manager can not manage them.
In order to keep isolation of vBridges and manage broadcast packets, if a VTN exists in a container, VTN Manager disables ArpHandler in the container.
