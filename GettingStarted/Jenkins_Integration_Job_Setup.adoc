[[introduction]]
== Introduction

The purpose of this job is to perform integration testing when a project
that your project depends on changes. So if projectA depends on
projectB, the project A jenkins would have a job
projectA-projectB-integration. This is accomplished by having the
integration Jenkins job poll every 10 minutes to see if the build number
for the latest merge build from project B has changed.

[[caveats]]
== Caveats

*Note:* to complete these steps you will need to be a committer on the
project for which you are doing it.

*Note:* in all examples given below, *repo_name* is used a stand in for
the repo name of your project and *project_name* is the name of your
project. "dependent_repo_name" is the name of the repo of a project you
depend on. Please substitute appropriately.

*Note:* For the deployment to Nexus to work the groupid in all of your
projects pom.xml files must be

org.opendaylight.repo_name

due to permission restrictions on Nexus. If you need to do something
different, please contact helpdesk@opendaylight.org.

*Note:* These instructions presume you have already
GettingStarted:Jenkins Merge Job Setup[Setup your Jenkins Merge Job]

[[detailed-steps]]
== Detailed Steps

1.  Navigate to the Jenkins for your project by going to
http://jenkins.opendaylight.org/repo_name/
2.  Log in
+
::
  image:Jenkins Verify Job Setup - Log In.jpg[Jenkins Verify Job Setup - Log In.jpg,title="fig:Jenkins Verify Job Setup - Log In.jpg"]
3.  Click on "New Job"
+
::
  image:Jenkins Verify Job - New Job.jpg[Jenkins Verify Job - New Job.jpg,title="fig:Jenkins Verify Job - New Job.jpg"]
1.  Name your Job repo_name-dependent_repo_name-intergration (examples:
controller-yangtools-integration, vtn-controller-integration, etc).
2.  Select *Copy existing Job* as your Job Type
3.  Enter "repo_name-merge" in "Copy from"
4.  Click *OK*.
+
::
  image:Jenkins_Integration_-_Job_Name.jpg[Jenkins_Integration_-_Job_Name.jpg,title="fig:Jenkins_Integration_-_Job_Name.jpg"]
4.  Update Description with something like "Build project_name - runs
right after dependent_repo_name SNAPSHOTS update to make sure we
integrate against them correctly. Polls every 10 minutes."
+
::
  image:Jenkins Integration - Job Description.jpg[Jenkins Integration - Job Description.jpg,title="fig:Jenkins Integration - Job Description.jpg"]
5.  Scroll down to the "Source Code Management" section
1.  Set the "Branch Specifier" to "origin/master"
+
::
  image:Jenkins_Integration_-_Branches_to_build.jpg[Jenkins_Integration_-_Branches_to_build.jpg,title="fig:Jenkins_Integration_-_Branches_to_build.jpg"]
2.  Change the "Strategy for choosing what to build" to "Default" (from
"Gerrit Trigger" which was inherited from the merge job)
+
::
  image:Jenkins_Integration_-_Chosing_strategy.png[Jenkins_Integration_-_Chosing_strategy.png,title="fig:Jenkins_Integration_-_Chosing_strategy.png"]
6.  Scroll down to "Build Triggers" and uncheck "Gerrit event" (this
will reveal new options)
+
::
  image:Jenkins_Integration_-_Uncheck_Gerrit_event.jpg[Jenkins_Integration_-_Uncheck_Gerrit_event.jpg,title="fig:Jenkins_Integration_-_Uncheck_Gerrit_event.jpg"]
7.  In the "Build Triggers" section
1.  Check "[URLTrigger] - Poll with a URL"
2.  Click "Add URL to monitor"
+
::
  image:Jenkins Integration - URLTrigger.jpg[Jenkins Integration - URLTrigger.jpg,title="fig:Jenkins Integration - URLTrigger.jpg"]
8.  Under the "[URL Trigger] - Poll with a URL"
1.  Enter "URL"
"https://jenkins.opendaylight.org/dependent_repo_name/job/dependent_repo_name-merge/lastSuccessfulBuild/buildNumber"
2.  Click "Advanced"
+
::
  image:Jenkins Integration - URLTrigger 2.jpg[Jenkins Integration - URLTrigger 2.jpg,title="fig:Jenkins Integration - URLTrigger 2.jpg"]
9.  In the "Client Parameters" "Timeout" enter "300"
+
::
  image:Jenkins Integration - URLTrigger 3.jpg[Jenkins Integration - URLTrigger 3.jpg,title="fig:Jenkins Integration - URLTrigger 3.jpg"]
10. Also in "[URLTrigger] - Poll with a URL"
1.  Check "Inspect URL content"
2.  In "Schedule" enter "H/10 * * * *"
+
::
  image:Jenkins Integration - URLTrigger 4.jpg[Jenkins Integration - URLTrigger 4.jpg,title="fig:Jenkins Integration - URLTrigger 4.jpg"]
3.  Under "Inspect URL content" select the "Add a content nature" and
select "Monitor a change of content"
+
::
  image:Jenkins Integration - Monitor a change of content.jpg[Jenkins Integration - Monitor a change of content.jpg,title="fig:Jenkins Integration - Monitor a change of content.jpg"]
11. In the "Post-build Actions" section
1.  Under "Deploy artifacts to Maven repository" click "Delete" (to
prevent redeploying artifacts during integration build)
2.  Under "Editable Email Notifications" change the "Default Subject"
subject to "[dependent_repo_name] $DEFAULT_SUBJECT"
3.  Click "Save"
+
::
  image:Jenkins_Integration_-_Do_not_Deploy_Artifacts.jpg[Jenkins_Integration_-_Do_not_Deploy_Artifacts.jpg,title="fig:Jenkins_Integration_-_Do_not_Deploy_Artifacts.jpg"]

