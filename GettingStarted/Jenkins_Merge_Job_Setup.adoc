[[introduction]]
== Introduction

The purpose of the Merge Job is to make sure that the branch (usually
master) is still healthy after the merge of a new patch and to publish
all the binary artifacts to the Nexus Repo (so we have fresh SNAPSHOTS
that match the branch) so others can consume them.

[[caveats]]
== Caveats

*Note:* to complete these steps you will need to be a committer on the
project for which you are doing it.

*Note:* in all examples given below, *repo_name* is used a stand in for
the repo name of your project and *project_name* is the name of your
project. Please substitute appropriately.

*Note:* For the deployment to Nexus to work the groupid in all of your
projects pom.xml files must be

org.opendaylight.repo_name

due to permission restrictions on Nexus. If you need to do something
different, please contact helpdesk@opendaylight.org.

*Note:* These instructions presume you have already
GettingStarted:Jenkins Verify Job Setup[Setup your Jenkins Verify Job]

[[detailed-steps]]
== Detailed Steps

1.  Navigate to the Jenkins for your project by going to
http://jenkins.opendaylight.org/repo_name/
2.  Log in
+
::
  image:Jenkins Verify Job Setup - Log In.jpg[Jenkins Verify Job Setup - Log In.jpg,title="fig:Jenkins Verify Job Setup - Log In.jpg"]
3.  Click on "New Job"
+
::
  image:Jenkins Verify Job - New Job.jpg[Jenkins Verify Job - New Job.jpg,title="fig:Jenkins Verify Job - New Job.jpg"]
1.  Name your Job repo_name-merge (examples: controller-verify,
vtn-verify, etc).
2.  Select *Copy existing Job* as your Job Type
3.  Enter "repo_name-verify" in "Copy from"
4.  Click *OK*.
+
::
  image:Jenkins Merge Job - Job Name.jpg[Jenkins Merge Job - Job Name.jpg,title="fig:Jenkins Merge Job - Job Name.jpg"]
4.  Scroll down to "Gerrit Trigger" -> "Trigger on"
1.  Delete "PatchSet Created" and "Draft Published"
+
::
  image:Jenkins Merge Job - Delete Triggers.jpg[Jenkins Merge Job - Delete Triggers.jpg,title="fig:Jenkins Merge Job - Delete Triggers.jpg"]
2.  Click "Add" and select "Change Merged"

image:Jenkins Merge Job - Add Trigger.jpg[Jenkins Merge Job - Add Trigger.jpg,title="Jenkins Merge Job - Add Trigger.jpg"]

1.  Add a Post Build-Action to deploy the artifacts from the main build
+
#: image:Add_deploy.png[Add_deploy.png,title="fig:Add_deploy.png"]
2.  Optionally in case there is a need to deploy also other artifacts
not generated by the build, like parent poms - Scroll down to "Post
Steps"
1.  Select "Run only if build succeeds"
2.  Click "Add post-build step" and select "Invoke top-level Maven
targets"
+
::
  image:Jenkins Merge Job - Post Steps 1.jpg[Jenkins Merge Job - Post Steps 1.jpg,title="fig:Jenkins Merge Job - Post Steps 1.jpg"]
3.  Select "Maven Version" "3.0.4"
4.  Enter "Goal" "Deploy"
5.  Click "Advanced"
+
::
  image:Jenkins Merge Job - Post Steps 2.jpg[Jenkins Merge Job - Post Steps 2.jpg,title="fig:Jenkins Merge Job - Post Steps 2.jpg"]
6.  In "POM" enter your root pom file (for example
commons/parent/pom.xml )
7.  In "Properties" enter

--------------------------------------------------------
maven.repo.local=$WORKSPACE/.m2repo
org.ops4j.pax.url.mvn.localRepository=$WORKSPACE/.m2repo
--------------------------------------------------------

1.  1.  In "JVM Options" enter

--------------------
-Xmx1024m
-XX:MaxPermSize=256m
--------------------

1.  1.  Click "Save"
+
::
  image:Jenkins Merge Job - Post Steps 3.jpg[Jenkins Merge Job - Post Steps 3.jpg,title="fig:Jenkins Merge Job - Post Steps 3.jpg"]

