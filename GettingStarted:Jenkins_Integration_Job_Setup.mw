== Introduction ==

The purpose of this job is to perform integration testing when a project that your project depends on changes.  So if projectA depends on projectB, the project A jenkins would have a job
projectA-projectB-integration.  This is accomplished by having the integration Jenkins job poll every 10 minutes to see if the build number for the latest merge build from project B has changed.

== Caveats ==

'''Note:''' to complete these steps you will need to be a committer on the project for which you are doing it.

'''Note:''' in all examples given below, '''repo_name''' is used a stand in for the repo name of your project and
'''project_name''' is the name of your project. "dependent_repo_name" is the name of the repo of a project you depend on.  Please substitute appropriately.

'''Note:''' For the deployment to Nexus to work the groupid in all of your projects pom.xml files must be 

<groupid>org.opendaylight.repo_name</groupid>

due to permission restrictions on Nexus.  If you need to do something different, please contact helpdesk@opendaylight.org.

'''Note:''' These instructions presume you have already [[GettingStarted:Jenkins Merge Job Setup|Setup your Jenkins Merge Job]]

== Detailed Steps ==

# Navigate to the Jenkins for your project by going to http://jenkins.opendaylight.org/repo_name/
# Log in
#: [[File:Jenkins Verify Job Setup - Log In.jpg|800px]]
# Click on "New Job"
#: [[File:Jenkins Verify Job - New Job.jpg|800px]]
## Name your Job repo_name-dependent_repo_name-intergration (examples: controller-yantools-integration, vtn-controller-integration, etc).
## Select '''Copy existing Job''' as your Job Type 
## Enter "repo_name-merge" in "Copy from"
## Click '''OK'''.
##: [[File:Jenkins_Integration_-_Job_Name.jpg|800px]]
# Update Description with something like "Build project_name - runs right after dependent_repo_name SNAPSHOTS update to make sure we integrate against them correctly.  Polls every 10 minutes."
#: [[File:Jenkins Integration - Job Description.jpg|800px]]
# Scroll down to the "Source Code Management" section
## Set the "Branch Specifier" to "origin/master"
## Click "Advanced"
##: [[File:Jenkins_Integration_-_Branches_to_build.jpg|800px]]
# Scroll down into the Advanced section and
## Uncheck "Merge option" "Merge before build"
## Select "Choosing Strategy" "Default"
##: [[File:Jenkins_Integration_-_Merge_options.jpg|800px]]
# Scroll down to "Build Triggers" and uncheck "Gerrit event" (this will reveal new options)
#: [[File:Jenkins_Integration_-_Uncheck_Gerrit_event.jpg|800px]]
#  In the "Build Triggers" section
## Check "[URLTrigger] - Poll with a URL"
## Click "Add URL to monitor"
##: [[File:Jenkins Integration - URLTrigger.jpg|800px]]
# Under the "[URL Trigger] - Poll with a URL" 
## Enter "URL" "https://jenkins.opendaylight.org/dependent_repo_name/job/dependent_repo_name-merge/lastSuccessfulBuild/api/xml?xpath=//originmaster/buildNumber"
## Click "Advanced"
##: [[File:Jenkins Integration - URLTrigger 2.jpg|800px]]
# In the "Client Parameters" "Timeout" enter "300"
#: [[File:Jenkins Integration - URLTrigger 3.jpg|800px]]
# Also in "[URLTrigger] - Poll with a URL"
## Check "Inspect URL content"
## In "Schedule" enter "H/10 * * * *"
##: [[File:Jenkins Integration - URLTrigger 4.jpg|800px]]
## Under "Inspect URL content" select the "Add a content nature" and select "Monitor a change of content"
##: [[File:Jenkins Integration - Monitor a change of content.jpg]]
# In the "Build Settings" section under "E-mail Notification" in the "Recipients" field enter "repo_name-jenkins@lists.opendaylight.org dependent_repo_name-jenkins@lists.opendaylight.org"
#: [[File:Jenkins_Integration_-_Email.jpg|800px]]
# In the "Post-build Actions" section 
## Under "Deploy artifacts to Maven repository" click "Delete" (to prevent redeploying artifacts during integration build)
## Click "Save"
##: [[File:Jenkins_Integration_-_Do_not_Deploy_Artifacts.jpg|800px]]
