=About=
This page provides the procedure to demonstrate configuration of [[OpenDaylight Virtual Tenant Network (VTN):VTN Coordinator|VTN Coordinator]] with L2 network using VTN Virtualization

[[File:Example for VTN Virtualization.png|border|530px]]

The OpenDaylight Virtualization information on Virtual Tenant Network can be found from the link below:

* [[OpenDaylight_Virtual_Tenant_Network_(VTN):Installation:Virtualization_Edition|VTN Virtualization]]

==L2 Network with Single Controller ==
Here is the Example for vBridge Interface Mapping with Single Controller using mininet. 
mininet details and set-up can be referred at below URL:
https://wiki.opendaylight.org/view/OpenDaylight_Controller:Installation#Using_Mininet

[[File:Single Controller Mapping.png|border|530px]]

- mininet command for above topology:
  mininet@mininet-vm:~$ sudo mn --controller=remote,ip=<controller-ip> --topo tree,2

* Create a Controller
{| class="wikitable"
|-
| curl -v -X POST -H username:admin -H password:adminpass -H 'content-type: application/json' -H 'ipaddr:127.0.0.1' -d '{"controller": {"controller_id": "controllerone", "ipaddr":"10.0.0.2", "type": "odc", "version": "1.0", "auditstatus":"enable"}}' http://127.0.0.1:8083/vtn-webapi/controllers.json   
|}

* Create a VTN 
{| class="wikitable"
|-
| curl -v -X POST -H username:admin -H password:adminpass -H 'content-type: application/json' -H 'ipaddr:127.0.0.1' -d '{"vtn" : {"vtn_name":"vtn1","description":"test VTN" }}' http://127.0.0.1:8083/vtn-webapi/vtns.json 
|}

* Create a vBridge in the VTN 
{| class="wikitable"
|-
| curl -v -X POST -H username:admin -H password:adminpass -H 'content-type: application/json' -H 'ipaddr:127.0.0.1' -d '{"vbridge" : {"vbr_name":"vBridge1","controller_id":"controllerone","domain_id":"(DEFAULT)" }}' http://127.0.0.1:8083/vtn-webapi/vtns/vtn1/vbridges.json
|}

* Create two Interfaces into the vBridge 
{| class="wikitable"
|-
| curl -v -X POST -H username:admin -H password:adminpass -H 'content-type: application/json' -H 'ipaddr:127.0.0.1' -d '{"interface": {"if_name": "if1","description": "if_desc1"}}' http://127.0.0.1:8083/vtn-webapi/vtns/vtn1/vbridges/vBridge1/interfaces.json
|-
|  curl -v -X POST -H username:admin -H password:adminpass -H 'content-type: application/json' -H 'ipaddr:127.0.0.1' -d '{"interface": {"if_name": "if2","description": "if_desc2"}}' http://127.0.0.1:8083/vtn-webapi/vtns/vtn1/vbridges/vBridge1/interfaces.json
|-
|}

* Get the list of logical ports configured
{| class="wikitable"
|-
| curl -v -X GET -H username:admin -H password:adminpass -H 'content-type: application/json' -H 'ipaddr:127.0.0.1' http://127.0.0.1:8083/vtn-webapi/controllers/controllerone/domains/\(DEFAULT\)/logical_ports.json
|-
|}

* Configure two mappings on the interfaces 
{| class="wikitable"
|-
| curl -v -X PUT -H username:admin -H password:adminpass -H 'content-type: application/json' -H 'ipaddr:127.0.0.1' -d '{"portmap":{"logical_port_id": "PP-OF:00:00:00:00:00:00:00:03-s3-eth1"}}' http://127.0.0.1:8083/vtn-webapi/vtns/vtn1/vbridges/vBridge1/interfaces/if1/portmap.json
|-
|  curl -v -X PUT -H username:admin -H password:adminpass -H 'content-type: application/json' -H 'ipaddr:127.0.0.1' -d '{"portmap":{"logical_port_id": "PP-OF:00:00:00:00:00:00:00:02-s2-eth1"}}' http://127.0.0.1:8083/vtn-webapi/vtns/vtn1/vbridges/vBridge1/interfaces/if2/portmap.json
|-
|}

* Send packets from Host1 to Host3
{| class="wikitable"
|-
|mininet> h1 ping h3
|}

==L2 Network with Multiple Controllers ==
Here is the Example for vBridge Interface Mapping with Multi-controller using mininet.

The mininet command for configuring multiple controllers is available [[OpenDaylight_Virtual_Tenant_Network_(VTN):Installation:VTN_Manager#Multiple_Clusters_of_Controllers|here]].

[[File:MutiController Example diagram.png|border|530px]]

* Create a VTN
{| class="wikitable"
|-
|curl -v -X GET -H username:admin -H password:adminpass -H 'content-type: application/json' -H 'ipaddr:127.0.0.1' -d '{"vtn" : {"vtn_name":"vtn3"}}' http://127.0.0.1:8083/vtn-webapi/vtns.json
|}
* Create two Controllers
{| class="wikitable"
|-
|curl -v -X POST -H username:admin -H password:adminpass  -H 'content-type: application/json' -H 'ipaddr:127.0.0.1' -d '{"controller": {"controller_id": "odc1", "ipaddr":"10.100.9.52", "type": "odc", "version": "1.0", "auditstatus":"enable"}}' http://127.0.0.1:8083/vtn-webapi/controllers.json
|-
|curl -v -X POST -H username:admin -H password:adminpass  -H 'content-type: application/json' -H 'ipaddr:127.0.0.1' -d '{"controller": {"controller_id": "odc2", "ipaddr":"10.100.9.61", "type": "odc", "version": "1.0", "auditstatus":"enable"}}' http://127.0.0.1:8083/vtn-webapi/controllers.json
|}

* Create two vBridges in the VTN like, vBridge1 in Controller1 and vBridge2 in Controller2
{| class="wikitable"
|-
| curl -v -X POST -H username:admin -H password:adminpass -H 'content-type: application/json' -H 'ipaddr:127.0.0.1' -d '{"vbridge" : {"vbr_name":"vbr1","controller_id":"odc1","domain_id":"(DEFAULT)" }}' http://127.0.0.1:8083/vtn-webapi/vtns/vtn3/vbridges.json
|-
|curl -v -X POST -H username:admin -H password:adminpass -H 'content-type: application/json' -H 'ipaddr:127.0.0.1' -d '{"vbridge" : {"vbr_name":"vbr2","controller_id":"odc1","domain_id":"(DEFAULT)" }}' http://127.0.0.1:8083/vtn-webapi/vtns/vtn3/vbridges.json
|}

* Create vBridge Interfaces
{| class="wikitable"
|-
|curl -v -X POST -H username:admin -H password:adminpass -H 'content-type: application/json' -H 'ipaddr:127.0.0.1' -d '{"interface": {"if_name": "if1"}}' http://127.0.0.1:8083/vtn-webapi/vtns/vtn3/vbridges/vbr1/interfaces.json
|-
|curl -v -X POST -H username:admin -H password:adminpass -H 'content-type: application/json' -H 'ipaddr:127.0.0.1' -d '{"interface": {"if_name": "if2"}}' http://127.0.0.1:8083/vtn-webapi/vtns/vtn3/vbridges/vbr1/interfaces.json
|-
|curl -v -X POST -H username:admin -H password:adminpass -H 'content-type: application/json' -H 'ipaddr:127.0.0.1' -d '{"interface": {"if_name": "if1"}}' http://127.0.0.1:8083/vtn-webapi/vtns/vtn3/vbridges/vbr2/interfaces.json
|-
|curl -v -X POST -H username:admin -H password:adminpass -H 'content-type: application/json' -H 'ipaddr:127.0.0.1' -d '{"interface": {"if_name": "if2"}}' http://127.0.0.1:8083/vtn-webapi/vtns/vtn3/vbridges/vbr2/interfaces.json
|}

* Get the list of logical ports configured
{| class ="wikitable"
|-
|curl -v -X GET -H username:admin -H password:adminpass -H 'content-type: application/json' http://127.0.0.1:8083/vtn-webapi/controllers/odc1/domains/\(DEFAULT\)/logical_ports/detail.json
|}

* Create boundary and vLink
{| class="wikitable"
|-
|curl -v -X POST -H username:admin -H password:adminpass -H 'content-type: application/json'  -H 'ipaddr:127.0.0.1' -d '{"boundary": {"boundary_id": "b1", "link": {"controller1_id": "odc1", "domain1_id": "(DEFAULT)", "logical_port1_id": "PP-OF:00:00:00:00:00:00:00:01-s1-eth3", "controller2_id": "odc2", "domain2_id": "(DEFAULT)", "logical_port2_id": "PP-OF:00:00:00:00:00:00:00:04-s4-eth3"}}}' http://127.0.0.1:8083/vtn-webapi/boundaries.json 
|-
|curl -v -X POST -H username:admin -H password:adminpass -H 'content-type: application/json' -H 'ipaddr:127.0.0.1' -d '{"vlink": {"vlk_name": "vlink1" , "vnode1_name": "vbr1", "if1_name":"if2", "vnode2_name": "vbr2", "if2_name": "if2", "boundary_map": {"boundary_id":"b1","vlan_id": "50"}}}' http://127.0.0.1:8083/vtn-webapi/vtns/vtn3/vlinks.json
|}
* Configure port-map on the interfaces
{| class="wikitable"
|-
| curl -v -X PUT -H username:admin -H password:adminpass -H 'content-type: application/json' -H 'ipaddr:127.0.0.1' -d '{"portmap":{"logical_port_id": "PP-OF:00:00:00:00:00:00:00:02-s2-eth2"}}' http://127.0.0.1:8083/vtn-webapi/vtns/vtn3/vbridges/vbr1/interfaces/if1/portmap.json
|-
|curl -v -X PUT -H username:admin -H password:adminpass -H 'content-type: application/json' -H 'ipaddr:127.0.0.1' -d '{"portmap":{"logical_port_id": "PP-OF:00:00:00:00:00:00:00:05-s5-eth2"}}' http://127.0.0.1:8083/vtn-webapi/vtns/vtn3/vbridges/vbr2/interfaces/if1/portmap.json
|}

* Send packets from h2 to h6
{| class="wikitable"
|-
|mininet> h2 ping h6
|}

==Read Physical Information==
* Get switch details
{| class="wikitable"
|-
| curl -v -X GET -H username:admin -H password:adminpass -H 'content-type: application/json' http://127.0.0.1:8083/vtn-webapi/controllers/odc1/switches/detail.json
|}

* Get port details
{| class="wikitable"
|-
| curl -v -X GET -H username:admin -H password:adminpass -H 'content-type: application/json' http://127.0.0.1:8083/vtn-webapi/controllers/odc1/switches/00:00:00:00:00:00:00:02/ports/detail.json
|}

* Get link details
{| class="wikitable"
|-
|curl -v -X GET -H username:admin -H password:adminpass -H 'content-type: application/json' http://127.0.0.1:8083/vtn-webapi/controllers/odc1/links/detail.json
|}


[[Category:OpenDaylight Virtual Tenant Network]]
