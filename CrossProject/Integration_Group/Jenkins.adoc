[[maintainer]]
== Maintainer

Luis Gomez (ecelgp@gmail.com)

[[introduction]]
== Introduction

We use Jenkins to trigger distributions and packages builds as well as
to perform system test (CSIT).

[[jenkins-strategy]]
== Jenkins Strategy

image:odl_integration_jenkins.png[odl_integration_jenkins.png,title="odl_integration_jenkins.png"]

[[jenkins-goals]]
=== Jenkins goals

* Build the distributions whenever we have new distribution code or
opendaylight project merge
* Build the linux packages (Fedora, Debian, Docker,...) whenever there
is new packaging code
* Run system test whenever we have new test code, distribution code or
opendaylight project merge
* Run package test whenever there is new packaging code
* System test bed has always latest successful test code and controller
artifacts
* We do not upload release artifacts to Nexus if they do not pass system
test

[[jenkins-triggers-and-tasks]]
=== Jenkins triggers and tasks

* Trigger 1) New patch in /distributions folder ->

Verify tasks: build distributions, update controller VM (just made
artifacts), run system test

* Trigger 2) Patch merged in /distributions folder ->

Merge tasks: build distributions, update controller VM (just made
artifacts), run system test, upload release artifacts to Nexus

* Trigger 3) New patch in /packaging folder ->

Verify tasks: build package, update package to controller VM, run
package test

* Trigger 4) Patch merged in /packaging folder ->

Merge tasks: build package, update package to controller VM, run package
test, upload package artifacts to Nexus

* Trigger 5) New patch in /test folder ->

Verify tasks: run system test (use Gerrit branch)

* Trigger 6) Patch merged in /test folder ->

Merge tasks: run system test (use Gerrit branch)

* Trigger 7) Change (merge) in other OpenDaylight project ->

Integration tasks: build distributions, update controller VM (just made
artifacts), run system test, upload release artifacts to Nexus

[[jenkins-task-distribution]]
=== Jenkins task distribution

* Integration Master Jenkins: distributions and packages build
* Robot Slave Jenkins: run system test
* Controller Slave Jenkins: update controller distribution

[[jenkins-jobs]]
== Jenkins jobs

[[deploy-jobs]]
=== Deploy Jobs

* *integration--deploy-controller-latest-* (BUNDLEVERSION, JOBNAME,
BUILDNUMBER). This job will:
** Update the controller VM with artifacts generated by the Jenkins job
$\{JOBNAME}-$\{BUILDNUMBER} for the distribution version
$\{BUNDLEVERSION}
** Start the controller with the new SW

* *integration--deploy-vtn-coordinator-latest* (VTNCOORDINATOR, JOBNAME,
BUILDNUMBER). This job will:
** Update the mininet VM with VTN Coordinator artifacts generated by the
Jenkins job $\{JOBNAME}-$\{BUILDNUMBER} for the VTN Coordinator version
$\{VTNCOORDINATOR}
** Start the controller with the new SW

[[verifymerge-test-jobs]]
=== Verify/Merge Test Jobs

* *integration--verify-test-*. This job will trigger on patch creation
under /test folder and will:
** Update controller with distribution
(integration--deploy-controller-latest-) using last successful artifacts
** Run Robot system test using GERRIT patch test code

* *integration--merge-test-*. This job will trigger on patch merge under
/test folder and will:
** Update controller with distribution
(integration--deploy-controller-latest-) using last successful base
artifacts
** Run Robot system test using just merged test code

[[csit-jobs]]
=== CSIT Jobs

* *integration--csit-* (BUNDLEVERSION, JOBNAME, BUILDNUMBER, PUSH). This
job will perform the system test with the following steps:
** Update controller with (integration--deploy-controller-latest-)
according to BUNDLEVERSION, JOBNAME, BUILDNUMBER described above
** Run Robot system test using system test code available at
/test/csit/suites
** In case system test is passed and $\{PUSH}=TRUE, upload release
artifacts to Nexus

[[verifymerge-distributions-jobs]]
=== Verify/Merge Distributions Jobs

* *integration--verify-distributions*. This job will trigger on patch
creation under /distributions folder and will:
** Build the OpenDaylight editions using GERRIT patch distribution code
** Extract the BUNDLEVERSION from the build
** Launch all relevant CSIT Jobs (integration--csit-) with
$\{BUNDLEVERSION}=version from previous step, $\{JOBNAME}=current
jobname, $\{BUILDNUMBER}=current build #, $\{PUSH)=TRUE

* *integration--merge-distributions*. This job will trigger on patch
merge under /distributions folder and will:
** Build the OpenDaylight editions using just merged distributions code
** Extract the BUNDLEVERSION from the build
** Launch all relevant CSIT Jobs (integration--csit-) with
$\{BUNDLEVERSION}=version from previous step, $\{JOBNAME}=current
jobname, $\{BUILDNUMBER}=current build #, $\{PUSH)=TRUE

[[integration-jobs]]
=== Integration Jobs

* *integration--project-centralized-integration*. This Job will:
** Build the OpenDaylight editions (Base, Service Provider,
Virtualization) using code available at /distributions
** Extract the BUNDLEVERSION from the build
** Launch all relevant CSIT Jobs (integration--csit-) with
$\{BUNDLEVERSION}=version from previous step, $\{JOBNAME}=current
jobname, $\{BUILDNUMBER}=current build #, $\{PUSH)=TRUE

[[polling-jobs]]
=== Polling Jobs

* *integration--polling-project-*. This job polls the merge builds. When
a merge happens this job will:
** Launch Integration Job (integration--project-centralized-integration)

[[jenkins-links]]
== Jenkins Links

* https://wiki.jenkins-ci.org/display/JENKINS/Meet+Jenkins[Jenkins page]
* https://jenkins.opendaylight.org/integration[Integration Jenkins]
* CrossProject:Integration_Group:Jenkins_Integration[Jenkins Integration
in Community Lab]

Category:Integration Group[Category:Integration Group]
