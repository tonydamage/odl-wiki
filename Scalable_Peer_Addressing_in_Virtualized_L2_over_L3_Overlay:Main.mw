
== Name  ==

Scalable peer addressing in virtualized L2-over-L3 overlay

== Repo Name ==

peeraddressing 

== Description  ==

VXLAN solves the scalability issue of VLAN and offers cross-datacenter support. However, VXLAN relies on multicast between VTEPs for address learning and broadcast. Multicast has scalability issue of its own, especially in virtualized environment where each of the 10s if not 100s of thousand hypervisors is a VTEP. Also, most data centers do not want to support broadcast and multicast due to issues they impose to the network infrastructure.

This project proposes and implements a scalable inter/intra-cluster& inter/intra-datacenter VXLAN peer addressing solution without using multicast. This same architecture applies to other virtualized L2 over L3 overlay as well, e.g. NVGRE, which can be supported with minor code change in later phases.

== Architecture ==

[[File:L2-over-L3-architecture.jpg|L2-over-L3-architecture.jpg]]

== Protocol ==

=== openvswitch <--> controller ===

Using openflow, raw packet, via TCP or SSL connection to controller.

=== Peer Addressing CRUD API ===

Restful API using JSON encoding as defined here:

==== Create/update address records ====

===== Request =====
<pre>

    {    
         "action" : "update-req",
         "msgid" : "msg id",
         "ts" : "timestamp",
         "saddr" : {"vlan" : "myvlans",  "gw": "1.2.3.4", "ip": " 1.2.3.4", "mac": "10:60:4b:7d:b5:1a"},
         "addrs" : [
               {"vlan" : "100",  "gw": "1.2.3.4", "ip": "192.168.1.2", "mac": "10:60:4b:7d:b5:aa"},
               {"vlan" : "100",  "gw": "1.2.3.4", "ip": "192.168.1.3", "mac": "10:60:4b:7d:b5:ab"}
         ]
    }

</pre>

===== Reply =====
<pre>

    {    
         "action" : "update-rep",
         "msgid" : "msg id",
         "ts" : "timestamp",
         "saddr" : {"vlan" : "myvlans",  "gw": "1.2.3.5", "ip": " 1.2.3.5", "mac": "10:60:4b:7d:b5:1b"},
         "addrs" : [
               {"vlan" : "100",  "gw": "1.2.3.4", "ip": "192.168.1.2", "stat": "done",  "reason" : ""},
               {"vlan" : "100",  "gw": "1.2.3.4", "ip": "192.168.1.3", "stat": "done",  "reason" : ""}
          ]
    }

</pre>

==== Query address records ====

===== Request =====

<pre>

    {    
         "action" : "query-req",
         "msgid" : "msg id",
         "ts" : "timestamp",
         "saddr" : {"vlan" : "100",  "gw" : "1.2.3.4", "ip" : "192.168.1.2", "mac" : "10:60:4b:7d:b5:aa"},
         "addrs" : [
               {"vlan" : "100", "ip" : "192.168.2.2"},
               {"vlan" : "100", "ip" : "192.168.2.3"}
           ]
    }

</pre>

===== Reply =====

<pre>

    {    
         "action" : "query-rep",
         "msgid" : "msg id",
         "ts" : "timestamp",
         "saddr" : {"vlan" : "myvlans",  "gw": "1.2.3.5", "ip": " 1.2.3.5", "mac": "10:60:4b:7d:b5:1b"},
         "addrs" : [
               {"vlan" : "100",  "gw": "1.2.3.4", "ip": "192.168.1.2", "mac": "10:60:4b:7d:b5:aa"},
               {"vlan" : "100",  "gw": "1.2.3.4", "ip": "192.168.1.3", "mac": "10:60:4b:7d:b5:ab"}
         ]
    }

</pre>

==== Delete address records ====

===== Request =====

<pre>

    {    
         "action" : "delete-req",
         "saddr" :  {"vlan" : "myvlans",  "gw": "1.2.3.4", "ip": " 1.2.3.4", "mac": "10:60:4b:7d:b5:1a"},
         "addrs" : [
                 {"vlan" : "100", "ip" : "192.168.2.2"},
                 {"vlan" : "100", "ip" : "192.168.2.3"}
         ]
    }

</pre>

===== Reply =====

<pre>

    {    
         "action" : "delete-rep",
         "msgid" : "msg id",
         "ts" : "timestamp",
         "saddr":      {"vlan" : "myvlans",  "gw": "1.2.3.5", "ip": " 1.2.3.5", "mac": "10:60:4b:7d:b5:1b"},
         "addrs": [
               {"vlan" : "100",  "gw": "1.2.3.4", "ip": "192.168.1.2", "stat": "done",  "reason" : ""},
               {"vlan" : "100",  "gw": "1.2.3.4", "ip": "192.168.1.3", "stat": "done",  "reason" : ""}
           ]
    }

</pre>


== Scope  ==
Scope of L2-over-L3 Peer Addressing includes:

* Providing openvswitch flow and configuration to support scalable peer addressing in network virtualization/segmentation via L2-over-L3 overlay.  
* Providing PeerAddressing OGSI module handling incoming VXLAN ARP requests and replies with the corresponding encapsulated ARP replies.
* Providing PeerAddressingNorthbound REST service to for update/query of peer addresses (GW & IP/MAC mapping) per virtualized L2 network
* Providing intra-cluster, inter-cluster support of scalable peer addressing within or across data centers.

== Resources Committed (developers committed to working)  ==

JZ (Jiangang Zhang)  <jgzhang@hotmail.com>
<br />
Andy Jiaming Zhang  <andy.jzsv@gmail.com>
<br />

== Initial Committers  ==

JZ (Jiangang Zhang)  <jgzhang@hotmail.com>
<br />
Andy Jiaming Zhang  <andy.jzsv@gmail.com>
<br />

== Vendor Neutral  ==

Completely Vendor agnostic

== Meets Board Policy (including IPR)  ==
Yes. Most/all of the code is written from scratch & it meets Board Policy.
