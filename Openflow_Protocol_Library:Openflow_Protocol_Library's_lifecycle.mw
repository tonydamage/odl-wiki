== Library's lifecycle ==
Steps (after the library's bundle is started):
* [1] Plugin configures the Library (adress, ports, encryption, ...)
* [2] Plugin injects its SwitchConnectionHandler into the Library
* [3] Plugin starts the Library
* [4] Library creates configured protocol handler (e.g. TCP Handler)
* [5] TCP Handler creates Publishing Channel Initializer on new / incoming switch connection
* [6] Publishing Channel Initializer asks plugin whether to accept incoming connection
* [7] Plugin responds:
** true - continue building pipeline
** false - reject connection / disconnect channel
* [8] Library notifies Plugin with onSwitchConnected(ConnectionAdapter) notification, announcing that pipeline handlers needed for communication have been created and Plugin can start communication
* [9] Plugin registers its system and message listeners
* [10] Plugin shutdowns the Library when desired



[[File:Library lifecycle.png | center | Library's lifecycle]]

== Integration with Plugin ==
{| class="wikitable"
|-
| '''Plugin'''
| '''SwitchConnectorHandler'''
* onSwitchConnected(''ConnectionAdapter'') [4]
:: <code>connectionAdapter.setMessageListener(ofProtocolListener)</code> [5]
:: <code>connectionAdapter.setSystemListener(systemListener)</code> [5]
* accept(''InetAddress'')
:: //policy logic
----
'''OFProtocolListener'''
* onHelloMessage(message)
* ...
----
'''SystemListener'''
* onDisconnectEvent(event)
----
call particular rpc method on particular instance of ''ConnectionAdapter'' to send message to particular switch [6][7]
|-
| '''Library'''
| '''SwitchConnectionProvider'''
* config() [1]
* startup() [2]
* shutdown() [8]
* setSwitchConnectionHandler(''SwitchConnectionHandler'') [1]

----
'''ConnectionAdapter''' extends OFProtocolService
* disconnect()
* sendMessage() -- via RPC (OFProtocolService)
* isAlive()
* setOFProtocolListener(''OFProtocolListener'') -- place to send message notifications
call ''OFProtocolListener'' when a message arrives  [6][7]
|}

==== Connection workflow ====
# @Plugin: config, set ''SwitchConnectionHandler''
# @Plugin: startup()
# new switch connects to netty layer
# @Library: onSwitchConnected(new ''ConnectionAdapter''...)
# @Plugin: setMessageListener(); setSystemListener();
# @both: send/receive Hello  (handshake)
# @both: do some switch exercise
# @Plugin: shutdown


==Openflow Protocol Library:Main page==
* [[Openflow Protocol Library:Main]]
